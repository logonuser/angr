<main class="container">
  <header class="header">
    <h1>Todo CRUD App</h1>
    <p>Powered by https://dummyjson.com/todos</p>
  </header>

  <section class="card">
    <h2>Create Todo</h2>
    <form class="create-form" (ngSubmit)="addTodo()">
      <label>
        Title
        <input
          type="text"
          name="newTodoText"
          [(ngModel)]="newTodoText"
          placeholder="Write a task"
          required
        />
      </label>

      <label>
        User ID
        <input type="number" name="newTodoUserId" [(ngModel)]="newTodoUserId" min="1" required />
      </label>

      <label class="checkbox-row">
        <input type="checkbox" name="newTodoCompleted" [(ngModel)]="newTodoCompleted" />
        Completed
      </label>

      <button type="submit" [disabled]="submitting">Add Todo</button>
    </form>
  </section>

  <section class="card">
    <div class="list-header">
      <h2>Todos</h2>
      <button type="button" (click)="loadTodos()" [disabled]="loading || submitting">Reload</button>
    </div>

    @if (errorMessage) {
      <p class="error">{{ errorMessage }}</p>
    }

    @if (loading) {
      <p>Loading todos...</p>
    } @else if (!todos.length) {
      <p>No todos available.</p>
    } @else {
      <ul class="todo-list">
        @for (todo of todos; track trackByTodoId($index, todo)) {
          <li class="todo-item">
            @if (editingTodoId === todo.id) {
              <div class="edit-block">
                <input type="text" [(ngModel)]="editTodoText" name="editTodoText-{{ todo.id }}" />
                <label class="checkbox-row">
                  <input
                    type="checkbox"
                    [(ngModel)]="editTodoCompleted"
                    name="editTodoCompleted-{{ todo.id }}"
                  />
                  Completed
                </label>
                <div class="actions">
                  <button type="button" (click)="saveEdit(todo.id)" [disabled]="submitting">Save</button>
                  <button type="button" (click)="cancelEdit()" [disabled]="submitting">Cancel</button>
                </div>
              </div>
            } @else {
              <div class="todo-row">
                <label class="todo-status">
                  <input
                    type="checkbox"
                    [checked]="todo.completed"
                    (change)="toggleComplete(todo)"
                    [disabled]="submitting"
                  />
                  <span [class.completed]="todo.completed">{{ todo.todo }}</span>
                </label>

                <small>User #{{ todo.userId }}</small>

                <div class="actions">
                  <button type="button" (click)="beginEdit(todo)" [disabled]="submitting">Edit</button>
                  <button type="button" (click)="deleteTodo(todo.id)" [disabled]="submitting">
                    Delete
                  </button>
                </div>
              </div>
            }
          </li>
        }
      </ul>
    }
  </section>
</main>
